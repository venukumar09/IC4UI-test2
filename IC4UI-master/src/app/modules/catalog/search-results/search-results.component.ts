import { Component, OnInit } from '@angular/core';
// import { Route } from '@angular/compiler/src/core';
import{ActivatedRoute, Router} from '@angular/router'
import { ApiService } from '../../../shared/services/api.service';
import { LocalStorageService } from 'ngx-webstorage';
@Component({
  selector: 'app-search-results',
  templateUrl: './search-results.component.html',
  styleUrls: ['./search-results.component.scss']
})
export class SearchResultsComponent implements OnInit {

  constructor(private route:ActivatedRoute,private router:Router,private service:ApiService,private storage:LocalStorageService) { }
  searchText:any="";
  mainSearchData=[];
  ngOnInit() {

   this.route.paramMap.subscribe(params=>{
    this.searchText=params.get('text')
    this.mainSearchData=[]
    this.landingLoad()
  })
    console.log(this.searchText)

  }

  landingLoad(){
    console.log(this.searchText)
    var data={
      'searchText':this.searchText,
      "userid":this.storage.retrieve('userid'),
      "orgid":this.storage.retrieve('orgid'),
      'filterParams':{
        'orgfilterdata': [], 'lobfilterdata': [], apnfilterdata: []
      }
    }
    // this.mainSearchData={
    //   "searchResults": [
    //     {
    //       "id": "5ff1f8da24b3b82812f242452fca85c5",
    //       "assetName": "Lob",
    //       "assetType": "File",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "SIT",
    //       "size": 153,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-05-02T00:00:00",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2019-06-20T10:57:30.149704",
    //       "frequency": null,
    //       "description": "This table contains general information which refers to a product or a set of related products that serve a particular customer transaction or business need. In some industry sectors, like insurance, \"line of business\" also has a regulatory and accounting definition to meet a statutory set of insurance policies. It may or may not be a strategically relevant business unit.",
    //       "schemaName": "Ins_Cust2",
    //       "type": "T",
    //       "ovlDqPct": 40,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": "gathi-rawzone",
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 1,
    //       "build_extract": 2,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "5ff1f8da24b3b82812f242452fca85c5",
    //       "assetName": "Lob",
    //       "assetType": "File",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "SIT",
    //       "size": 153,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-05-02T00:00:00",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2019-06-20T10:57:30.149704",
    //       "frequency": null,
    //       "description": "This table contains general information which refers to a product or a set of related products that serve a particular customer transaction or business need. In some industry sectors, like insurance, \"line of business\" also has a regulatory and accounting definition to meet a statutory set of insurance policies. It may or may not be a strategically relevant business unit.",
    //       "schemaName": "Ins_Cust2",
    //       "type": "T",
    //       "ovlDqPct": 60,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": "gathi-rawzone",
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 1,
    //       "build_extract": 2,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "a2904b7063b9fa7f963121ecc2607873",
    //       "assetName": "CUSTOMER_DTL",
    //       "assetType": "Table",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "MICROSOFT SQL SERVER",
    //       "site": "SIT",
    //       "size": 11,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2020-01-24T14:35:39",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2020-02-28T00:04:45.619247",
    //       "frequency": null,
    //       "description": "",
    //       "schemaName": "master.master",
    //       "type": "T",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": null,
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 1,
    //       "build_extract": 2,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "a7d78d46ee3d069e35a3bbfd27fab875",
    //       "assetName": "Consumer_info",
    //       "assetType": "File",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "UAT",
    //       "size": null,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2020-03-19T00:00:00",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2020-03-21T21:05:54.713856",
    //       "frequency": null,
    //       "description": "the customer personal information",
    //       "schemaName": "Ins_cust_details_x",
    //       "type": "T",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": "gathi-rawzone",
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 1,
    //       "build_extract": 2,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "b0f1654daaabd6b05ec06ba67aa69b11",
    //       "assetName": "km45_v",
    //       "assetType": "View",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HIVE",
    //       "site": "SIT",
    //       "size": 7,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-07-01T12:52:02.191768",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2019-07-01T12:52:02.189558",
    //       "frequency": null,
    //       "description": "Customer data from km45 mysql table for daily test",
    //       "schemaName": "gathi_ins_intgn_v",
    //       "type": "T",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": "intzone-gathi",
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 2,
    //       "build_extract": 1,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "f3446f77952d0c3c074cd26bbfdc942b",
    //       "assetName": "Client_info_file",
    //       "assetType": "File",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "UAT",
    //       "size": null,
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "slaMisses": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-11-18T00:00:00",
    //       "lastLoadedDate": 0,
    //       "lastUpdatedDate": "2019-11-18T16:46:22.146162",
    //       "frequency": null,
    //       "description": "the customer personal information",
    //       "schemaName": "Ins_cust_details",
    //       "type": "T",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "jobName": null,
    //       "layerName": "gathi-rawzone",
    //       "ownrMailId": "swamym@gathi.com",
    //       "cnfdl_flg": "N",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": 1,
    //       "build_ingestion": 1,
    //       "build_extract": 2,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "0e06e655458adb4e9fc07def9159f39a",
    //       "assetName": "estimated_arrival_date",
    //       "tableName": "AzFulFilledShipments",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "UAT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2020-02-13T06:12:45.961723",
    //       "frequency": 0,
    //       "description": "The estimated date of delivery to the customer.",
    //       "schemaName": "mdesign",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "2481623da3431682272275e21e7c498e",
    //       "assetName": "customerSince",
    //       "tableName": "Claims",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2019-05-07T08:59:29.887583",
    //       "frequency": 0,
    //       "description": null,
    //       "schemaName": "Htc_Cust2",
    //       "type": "C",
    //       "ovlDqPct": 40,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "36feccf02ab4f974e8763e85ce4c5dee",
    //       "assetName": "months_as_customer",
    //       "tableName": "Claims",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2019-05-07T08:59:29.883247",
    //       "frequency": 0,
    //       "description": null,
    //       "schemaName": "Htc_Cust2",
    //       "type": "C",
    //       "ovlDqPct": 60,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "54f0d97ab8e7d444f8c6c40140cfa514",
    //       "assetName": "months_as_customer",
    //       "tableName": "Claims_v",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HIVE",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-05-08T14:02:19.038421",
    //       "lastUpdatedDate": "2019-05-08T14:02:19.038422",
    //       "frequency": 0,
    //       "description": "",
    //       "schemaName": "Gathi_Ins_Intgn_v",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "7beb40b0f7441ed6de1a969125c0bd74",
    //       "assetName": "User_id",
    //       "tableName": "Jared_ADS_conversion_New",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HTTPS",
    //       "site": "UAT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2020-02-27T13:09:25.939431",
    //       "frequency": 0,
    //       "description": "Default user ID in descending order of priority: - Matched Customer ID from Transaction File, if available - Salted/hashed Conversant Cookie ID ",
    //       "schemaName": "ADS",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "826a4c77a3835523683c5892cf36aa85",
    //       "assetName": "Cust_Name",
    //       "tableName": "Account_dtl",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "Transactions",
    //       "dataPlatform": "MICROSOFT SQL SERVER",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2019-11-05T00:01:25.680535",
    //       "frequency": 0,
    //       "description": null,
    //       "schemaName": "Modern_Bank.Modern_Bank",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "",
    //       "ownrMailId": "",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "96b85062051cc34c047d6744c9b4a4c0",
    //       "assetName": "customerSince",
    //       "tableName": "Claims_v",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "HIVE",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": "2019-05-08T14:02:19.045667",
    //       "lastUpdatedDate": "2019-05-08T14:02:19.045669",
    //       "frequency": 0,
    //       "description": "",
    //       "schemaName": "Gathi_Ins_Intgn_v",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     },
    //     {
    //       "id": "abe66496f9d44bac10d5e6b70da6de37",
    //       "assetName": "Cust_Name",
    //       "tableName": "CUSTOMER_DTL",
    //       "assetType": "column",
    //       "crtLevel_1": null,
    //       "crtLevel_2": null,
    //       "crtLevel_3": null,
    //       "certifiedBy": null,
    //       "applicationName": "CRM",
    //       "dataPlatform": "MICROSOFT SQL SERVER",
    //       "site": "SIT",
    //       "usedInApplication": 0,
    //       "usedInReport": 0,
    //       "dataQuality": 0,
    //       "lob": "Life Insurance",
    //       "creationDate": null,
    //       "lastUpdatedDate": "2020-02-28T00:04:45.672939",
    //       "frequency": 0,
    //       "description": null,
    //       "schemaName": "master.master",
    //       "type": "C",
    //       "ovlDqPct": null,
    //       "ownrName": "Gaurav",
    //       "ownrMailId": "swamym@gathi.com",
    //       "know_your_data": 1,
    //       "parentCategory": null,
    //       "category": null,
    //       "explore_data": null,
    //       "build_ingestion": 0,
    //       "build_extract": 0,
    //       "rank": null,
    //       "apn_status": 1
    //     }
    //   ],
    //   "finalAssetTypes": [
    //     "column",
    //     "file",
    //     "table",
    //     "view"
    //   ],
    //   "finalDataPlatforms": [
    //     "hive",
    //     "https",
    //     "microsoft sql server"
    //   ],
    //   "finalApplications": [
    //     "crm",
    //     "transactions"
    //   ],
    //   "finalParentCategories": [],
    //   "finalCategories": []
    // }
    this.service.post(this.service.mainSearch,data).subscribe(res=>{
      console.log(res)
      this.mainSearchData=res.searchResults;
    });
  }

  knowUrData(data){
    console.log(data)
    if(data.assetType=="View"||data.assetType=="Table"){
      this.router.navigate(['/catalog/assetDetails/File/', data.id, true], { queryParams: { view: 'details' } });
      // this.router.navigate(['/catalog/assetDetails/Table/', data.id, true], { queryParams: { view: 'details' } });
    }else if(data.assetType=="column"){
      this.router.navigate(['/catalog/assetDetails/Column/', data.id, true], { queryParams: { view: 'details' } });
    }
    else{
      this.router.navigate(['/catalog/assetDetails/'+data.assetType+'/', data.id, true], { queryParams: { view: 'details' } });
    }
    // this.router.navigate(['/catalog/assetDetails']);

  }

  formbuild(data){
    console.log(data)
    this.router.navigate(['/catalog/form-based-ingestion', data.id, true], { queryParams: { view: 'details' , name: data.assetName} });
  }

  configureDQ(data){
    if(data.dataPlatform.toLowerCase() == 'streaming'){
      this.router.navigate(['/catalog/streamingdq/', data.id], { queryParams: { view: 'details' } });

    }else if(data.dataPlatform.toLowerCase() == 'snowflake' || data.dataPlatform.toLowerCase() == 'http'){
      this.router.navigate(['/catalog/dq/rules', data.id], { queryParams: { view: 'details' } });
    } else {
      this.router.navigate(['/catalog/dq-config/', data.id, true], { queryParams: { view: 'details' } });
    }
  }
}
